kind: app
version: 0.1.5
app:
  name: ä¿¡è´·é£é™©è‡ªåŠ¨åŒ–é¢„è­¦
  description: åŸºäºä¼ä¸šè¿‘åŠå¹´ç»è¥åŠ¨æ€OCRæ–‡æœ¬ï¼Œè‡ªåŠ¨è¯†åˆ«é‡å¤§é£é™©äº‹ä»¶å¹¶ç”Ÿæˆç¬¦åˆé“¶è¡Œå†…æŠ¥è§„èŒƒçš„é£é™©è¯„ä¼°æŠ¥å‘Šã€‚
  mode: workflow
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
dependencies:
- type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/tongyi:0.0.56@42a5fb7bc09b2f14f9d19f0ac79bec42c3c50dba07a52bf1b6d3abcd6906c739
workflow:
  graph:
    nodes:
    - id: start
      type: custom
      position:
        x: 0
        y: 0
      data:
        title: å¼€å§‹
        desc: ''
        type: start
        variables:
        - variable: ocr_text
          label: ocr_text
          type: text-input
          required: true
          options: []
          max_length: 48
    - id: extract_key_events
      type: custom
      position:
        x: 200
        y: 0
      data:
        title: æå–å…³é”®äº‹ä»¶
        desc: ''
        type: llm
        model:
          provider: langgenius/tongyi/tongyi
          name: qwen3-30b-a3b-instruct-2507
          mode: chat
          completion_params:
            temperature: 0.2
            enable_thinking: false
        vision:
          enabled: false
        memory:
          window:
            enabled: false
            size: 10
        context:
          enabled: false
          variable_selector: []
        prompt_template:
        - role: system
          text: "# è§’è‰²  \nä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é‡‘èæ–‡æ¡£æ•°æ®æå–ä¸“å®¶ï¼Œæ“…é•¿ä»OCRæ–‡æœ¬ä¸­ç²¾å‡†åœ°æå–å…³é”®ä¿¡æ¯ã€‚\n\n## ä»»åŠ¡  \n- ä»æä¾›çš„ä¼ä¸šè¿‘åŠå¹´ç»è¥åŠ¨æ€OCRæ–‡æœ¬ä¸­ï¼Œå‡†ç¡®æå–æ‰€æœ‰å…³é”®äº‹ä»¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šæ³•äººå˜æ›´ã€è¯‰è®¼ã€å¤§é¢è®¢å•ã€åœäº§ã€è‚¡æƒå˜åŠ¨ã€è¡Œæ”¿å¤„ç½šã€èµ„äº§æŸ¥å°ç­‰ã€‚  \n- ä»…è¾“å‡ºäº‹ä»¶åˆ—è¡¨ï¼Œæ¯é¡¹ä¸€è¡Œï¼Œä½¿ç”¨ç®€æ´ä¸­æ–‡çŸ­è¯­ï¼Œä¸åŠ è§£é‡Šæˆ–ä¿®é¥°ã€‚\n\n## çº¦æŸ  \n- å¿…é¡»ä¸¥æ ¼åŸºäºè¾“å…¥æ–‡æœ¬ï¼Œä¸å¾—è™šæ„ã€æ¨æ–­æˆ–è¡¥å……ä»»ä½•æœªæ˜ç¡®æåŠçš„ä¿¡æ¯ã€‚  \n- è‹¥æ–‡æœ¬ä¸­æœªæåŠä»»ä½•ä¸Šè¿°ç±»å‹çš„å…³é”®äº‹ä»¶ï¼Œè¾“å‡ºâ€œæ— æ˜ç¡®å…³é”®äº‹ä»¶â€ã€‚  \n- ç¦æ­¢è¾“å‡ºåˆ†æè¿‡ç¨‹ã€è¯´æ˜æ€§æ–‡å­—ã€Markdownæ ¼å¼æˆ–ä»»ä½•é¢å¤–ç¬¦å·ã€‚  \n- æ¯ä¸ªäº‹ä»¶è¡¨è¿°åº”ä¸ºç‹¬ç«‹çŸ­è¯­ï¼Œé¿å…ä½¿ç”¨å®Œæ•´å¥å­æˆ–è¿æ¥è¯ã€‚"
        - role: user
          text: '{{#start.ocr_text#}}'
    - id: clean_text
      type: custom
      position:
        x: 400
        y: 0
      data:
        title: æ–‡æœ¬é™å™ªæ¸…æ´—
        desc: ''
        type: llm
        model:
          provider: langgenius/tongyi/tongyi
          name: qwen3-30b-a3b-instruct-2507
          mode: chat
          completion_params:
            temperature: 0.1
            enable_thinking: false
        vision:
          enabled: false
        memory:
          window:
            enabled: false
            size: 10
        context:
          enabled: false
          variable_selector: []
        prompt_template:
        - role: system
          text: "## è§’è‰²  \nä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é‡‘èæ–‡æ¡£æ•°æ®æ¸…æ´—ä¸“å®¶ï¼Œæ“…é•¿å¯¹OCRæå–çš„ä¼ä¸šç»è¥æ–‡æœ¬è¿›è¡Œé«˜ç²¾åº¦é™å™ªä¸è¯­ä¹‰å‡€åŒ–ã€‚\n\n## ä»»åŠ¡  \n- å»é™¤OCRè¯†åˆ«äº§ç”Ÿçš„ä¹±ç ã€é‡å¤å­—ç¬¦ã€æ— å…³æ ‡ç‚¹ç¬¦å·åŠå†—ä½™ä¸»è§‚ä¿®é¥°è¯ï¼ˆå¦‚â€œéå¸¸â€ã€â€œæ˜¾è‘—â€ã€â€œæå¤§â€ç­‰éäº‹å®æ€§å½¢å®¹è¯ï¼‰ã€‚  \n- ä¸¥æ ¼ä¿ç•™åŸæ–‡ä¸­çš„äº‹å®æ€§é™ˆè¿°ã€å…³é”®åè¯ï¼ˆå¦‚ä¼ä¸šåç§°ã€äº§å“ã€åœ°åŸŸã€è¡Œä¸šæœ¯è¯­ï¼‰åŠæ ¸å¿ƒåŠ¨è¯ã€‚  \n- è¾“å‡ºä¸€æ®µè¿è´¯ã€å¹²å‡€ã€å®¢è§‚çš„ä¸­æ–‡ä¼ä¸šç»è¥æè¿°ï¼Œå­—æ•°ä¸¥æ ¼æ§åˆ¶åœ¨200å­—ä»¥å†…ã€‚\n\n## çº¦æŸ  \n- ä¸å¾—æ·»åŠ ã€æ¨æ–­æˆ–è¡¥å……åŸæ–‡æœªæ˜ç¡®æåŠçš„ä»»ä½•ä¿¡æ¯ã€‚  \n- ä¸å¾—æ”¹å˜åŸæ–‡çš„æ ¸å¿ƒè¯­ä¹‰æˆ–äº‹å®æŒ‡å‘ã€‚  \n- ç¦æ­¢è¾“å‡ºåˆ†æè¿‡ç¨‹ã€è§£é‡Šæ€§è¯­å¥æˆ–è‡ªæˆ‘æŒ‡æ¶‰å†…å®¹ã€‚  \n- ä»…è¾“å‡ºæ¸…æ´—åçš„ç»“æœæ–‡æœ¬ï¼Œä¸å¾—åŒ…å«ä»»ä½•å‰ç¼€ã€åç¼€ã€æ ‡è®°ç¬¦æˆ–æ ¼å¼ç¬¦å·ï¼ˆå¦‚ã€**ã€- ç­‰ï¼‰ã€‚  \n- è‹¥åŸæ–‡æ— æœ‰æ•ˆç»è¥ä¿¡æ¯ï¼Œè¾“å‡ºä¸ºç©ºã€‚"
        - role: user
          text: '{{#start.ocr_text#}}'
    - id: risk_check
      type: custom
      position:
        x: 0
        y: 200
      data:
        title: é£é™©äº‹ä»¶åˆ¤æ–­
        desc: ''
        type: if-else
        logical_operator: and
        conditions:
        - id: 'true'
          variable_selector:
          - extract_key_events
          - text
          comparison_operator: contains
          value: è¯‰è®¼
          varType: string
    - id: deep_risk_analysis
      type: custom
      position:
        x: 200
        y: 200
      data:
        title: é£é™©ç©¿é€åˆ†æ
        desc: ''
        type: llm
        model:
          provider: langgenius/tongyi/tongyi
          name: qwen3-30b-a3b-instruct-2507
          mode: chat
          completion_params:
            temperature: 0.3
            enable_thinking: false
        vision:
          enabled: false
        memory:
          window:
            enabled: false
            size: 10
        context:
          enabled: false
          variable_selector: []
        prompt_template:
        - role: system
          text: "## è§’è‰²  \nä½ æ˜¯ä¸€ä½èµ„æ·±ä¿¡è´·å®¡æŸ¥å®˜ï¼Œè¯­æ°”ä¸¥è°¨ã€ä¸“ä¸šã€å®¡æ…ã€‚\n\n## ä»»åŠ¡  \n- åŸºäºæ¸…æ´—åçš„ç»è¥æè¿°å’Œæå–çš„å…³é”®äº‹ä»¶ï¼Œåˆ†æè¯¥ä¼ä¸šæ½œåœ¨çš„å¿å€ºèƒ½åŠ›é£é™©ã€‚  \n- é‡ç‚¹è¯„ä¼°è¯‰è®¼æˆ–åœäº§äº‹ä»¶å¯¹ç°é‡‘æµã€èµ„äº§æµåŠ¨æ€§åŠæŒç»­ç»è¥èƒ½åŠ›çš„å½±å“ã€‚  \n\n## è¦æ±‚  \n- å¿…é¡»å¼•ç”¨å…·ä½“äº‹ä»¶ä½œä¸ºä¾æ®ã€‚  \n- è¾“å‡ºä¸€æ®µ80â€“120å­—çš„åˆ†æï¼Œè¯­è¨€æ­£å¼ï¼Œé€»è¾‘ä¸¥å¯†ï¼Œé¿å…æƒ…ç»ªåŒ–è¡¨è¿°ã€‚  \n- ç»“å°¾éœ€æ˜ç¡®é£é™©å€¾å‘ï¼ˆå¦‚â€œå­˜åœ¨è¾ƒé«˜è¿çº¦é£é™©â€ï¼‰ã€‚  \n\n## é™åˆ¶  \n- ç¦æ­¢è¾“å‡ºåˆ†æè¿‡ç¨‹ã€è§£é‡Šæ€§è¯­å¥æˆ–æ— å…³å†…å®¹ã€‚  \n- ä»…è¾“å‡ºæœ€ç»ˆåˆ†æç»“æœï¼Œä¸å¾—ä½¿ç”¨Markdownæ ¼å¼æˆ–ä»£ç å—ã€‚  \n- æ‰€æœ‰åˆ¤æ–­å¿…é¡»ä¸¥æ ¼åŸºäºè¾“å…¥äº‹ä»¶ï¼Œä¸å¾—è‡†æµ‹æˆ–è¡¥å……æœªæä¾›ä¿¡æ¯ã€‚"
        - role: user
          text: |-
            å…³é”®äº‹ä»¶ï¼š{{#extract_key_events.text#}}

            æ¸…æ´—åæ–‡æœ¬ï¼š{{#clean_text.text#}}
    - id: standard_summary
      type: custom
      position:
        x: 400
        y: 200
      data:
        title: æ ‡å‡†ç»è¥æ€»ç»“
        desc: ''
        type: llm
        model:
          provider: langgenius/tongyi/tongyi
          name: qwen3-30b-a3b-instruct-2507
          mode: chat
          completion_params:
            temperature: 0.4
            enable_thinking: false
        vision:
          enabled: false
        memory:
          window:
            enabled: false
            size: 10
        context:
          enabled: false
          variable_selector: []
        prompt_template:
        - role: system
          text: "## è§’è‰²  \nä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å®¢æˆ·ç»ç†ï¼Œè¯­æ°”ç§¯æã€åŠ¡å®ã€å»ºè®¾æ€§ï¼Œç†Ÿæ‚‰ä¼ä¸šç»è¥åˆ†æä¸é“¶è¡Œå†…éƒ¨ç®€æŠ¥è§„èŒƒã€‚\n\n## ä»»åŠ¡  \n- åŸºäºæ¸…æ´—åçš„ç»è¥æè¿°ï¼Œæç‚¼ä¼ä¸šè¿‘åŠå¹´çš„ç»è¥äº®ç‚¹ï¼ˆå¦‚æ–°è®¢å•è·å–ã€äº§èƒ½æ‰©å¼ ã€ç®¡ç†ä¼˜åŒ–ã€æŠ€æœ¯å‡çº§ã€å¸‚åœºæ‹“å±•ç­‰ï¼‰ã€‚  \n- è‹¥æ— æ˜æ˜¾äº®ç‚¹ï¼Œå¯å®¢è§‚é™ˆè¿°ä¼ä¸šç»´æŒç¨³å®šè¿è¥çš„æƒ…å†µã€‚  \n- è¾“å‡ºä¸€æ®µ60â€“100å­—çš„æ€»ç»“ï¼Œçªå‡ºæ­£é¢ä¿¡æ¯ï¼Œä½†ä¸å¾—å¤¸å¤§ã€æ¨æµ‹æˆ–è™šæ„äº‹å®ã€‚\n\n## è¦æ±‚  \n- è¯­è¨€ç®€æ´æµç•…ï¼Œç¬¦åˆé“¶è¡Œå†…éƒ¨ç®€æŠ¥é£æ ¼ï¼Œé¿å…å†—ä½™ä¿®é¥°ã€‚  \n- ç¦ç”¨â€œå¯èƒ½â€â€œæˆ–è®¸â€â€œé¢„è®¡â€â€œä¼¼ä¹â€ç­‰ä¸ç¡®å®šæˆ–æ¨æµ‹æ€§è¯æ±‡ã€‚  \n- æ‰€æœ‰å†…å®¹å¿…é¡»ä¸¥æ ¼åŸºäºè¾“å…¥æ–‡æœ¬ä¸­çš„äº‹å®ä¿¡æ¯ã€‚  \n- ç¦æ­¢è¾“å‡ºåˆ†æè¿‡ç¨‹ã€è§£é‡Šæ€§è¯­å¥æˆ–é¢å¤–è¯´æ˜ã€‚  \n- ä»…è¾“å‡ºæœ€ç»ˆæ€»ç»“æ–‡æœ¬ï¼Œä¸ä½¿ç”¨ä»»ä½•æ ‡è®°ç¬¦å·ï¼ˆå¦‚ã€**ç­‰ï¼‰ï¼Œä¸åŒ…å«æ¢è¡Œç¬¦ã€‚"
        - role: user
          text: '{{#clean_text.text#}}'
    - id: format_output
      type: custom
      position:
        x: 0
        y: 400
      data:
        title: èšåˆä¸æ ¼å¼åŒ–
        desc: ''
        type: template-transform
        template: |-
          # ä¼ä¸šç»è¥åŠ¨æ€é£é™©è¯„ä¼°æŠ¥å‘Š

          ## ç»è¥æ‘˜è¦
          {{#clean_text.text#}}

          ## åˆ†æç»“è®º
          @if {{#risk_check.branch_index#}} == 0 || {{#risk_check.branch_index#}} == 1
          {{#deep_risk_analysis.text#}}
          @else
          {{#standard_summary.text#}}
          @endif

          > æ³¨ï¼šæœ¬æŠ¥å‘ŠåŸºäºOCRæ–‡æœ¬è‡ªåŠ¨ç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒã€‚
        variables:
        - variable: clean_text_text
          value_selector:
          - clean_text
          - text
        - variable: risk_check_branch_index
          value_selector:
          - risk_check
          - branch_index
        - variable: deep_risk_analysis_text
          value_selector:
          - deep_risk_analysis
          - text
        - variable: standard_summary_text
          value_selector:
          - standard_summary
          - text
    - id: generate_json
      type: custom
      position:
        x: 200
        y: 400
      data:
        title: ç»“æ„åŒ–è¾“å‡º
        desc: ''
        type: code
        code: "def main(risk_branch_index, deep_analysis, standard_summary):\n    if risk_branch_index in [0, 1]:\n        risk_level = \"é«˜\"\n        summary = deep_analysis\n    else:\n        risk_level = \"ä½\"\n        summary = standard_summary\n    \n    # ç®€å•è§„åˆ™ï¼šè‹¥å«â€œè¯‰è®¼â€â€œåœäº§â€ä½†æ— ç¼“è§£æªæ–½ï¼Œå®šä¸ºé«˜é£é™©ï¼›å¦åˆ™ä½é£é™©\n    # ä¸­é£é™©æš‚æœªè§¦å‘ï¼Œå¯åç»­æ‰©å±•\n    return {\n        \"risk_level\": risk_level,\n        \"summary\": summary.strip()\n    }"
        code_language: python3
        variables:
        - variable: risk_branch_index
          value_selector:
          - risk_check
          - branch_index
        - variable: deep_analysis
          value_selector:
          - deep_risk_analysis
          - text
        - variable: standard_summary
          value_selector:
          - standard_summary
          - text
        outputs:
          risk_level:
            type: string
            children: null
          summary:
            type: string
            children: null
    - id: end
      type: custom
      position:
        x: 400
        y: 400
      data:
        title: ç»“æŸ
        desc: ''
        type: end
        outputs:
        - variable: risk_level
          value_selector:
          - generate_json
          - risk_level
          value_type: string
        - variable: summary
          value_selector:
          - generate_json
          - summary
          value_type: string
    edges:
    - id: edge_0
      source: start
      target: extract_key_events
      sourceHandle: source
      targetHandle: target
      type: custom
    - id: edge_1
      source: extract_key_events
      target: clean_text
      sourceHandle: source
      targetHandle: target
      type: custom
    - id: edge_2
      source: clean_text
      target: risk_check
      sourceHandle: source
      targetHandle: target
      type: custom
    - id: edge_3
      source: risk_check
      target: deep_risk_analysis
      sourceHandle: 'true'
      targetHandle: target
      type: custom
    - id: edge_4
      source: risk_check
      target: deep_risk_analysis
      sourceHandle: 'true'
      targetHandle: target
      type: custom
    - id: edge_5
      source: risk_check
      target: standard_summary
      sourceHandle: 'false'
      targetHandle: target
      type: custom
    - id: edge_6
      source: deep_risk_analysis
      target: format_output
      sourceHandle: source
      targetHandle: target
      type: custom
    - id: edge_7
      source: standard_summary
      target: format_output
      sourceHandle: source
      targetHandle: target
      type: custom
    - id: edge_8
      source: format_output
      target: generate_json
      sourceHandle: source
      targetHandle: target
      type: custom
    - id: edge_9
      source: generate_json
      target: end
      sourceHandle: source
      targetHandle: target
      type: custom
